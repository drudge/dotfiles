#!/bin/bash

location=$(scselect 2>&1|grep ' \* ' | awk '{print $NF}' | sed 's/(//g;s/)//g')

if [ ! -f ~/.ssh/config.d/all.conf ]; then
  echo '~/.ssh/config.d/all.conf does not exist, aborting!'
  exit 1
fi

echo '##' > ~/.ssh/config
echo '## Auto-generated by locationchanger' >> ~/.ssh/config
echo "## on $(date)" >> ~/.ssh/config
echo '##' >> ~/.ssh/config

# The most specific config should come first
if [ -f ~/.ssh/config.d/$location.conf ]; then
  # protect against no newline at EOF
  echo >> ~/.ssh/config
  cat ~/.ssh/config.d/$location.conf >> ~/.ssh/config
fi

# Add the shared config, if it exists
if [ -f ~/.ssh/config.d/all.conf ]; then
  # protect against no newline at EOF
  echo >> ~/.ssh/config
  cat ~/.ssh/config.d/all.conf >> ~/.ssh/config
fi